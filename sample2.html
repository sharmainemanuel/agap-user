
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  
<link rel="stylesheet" type="text/css" href="/css/result-light.css">
 
    
 <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry,places&ext=.js"></script>
    
  <style type="text/css">
    
  </style>

  <title></title>

  
    




<script type='text/javascript'>

	getLocation();  
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
		//	console.log("get location");
    } else { 
        x.innerHTML = "please check your GPS.";
		console.log("error in getting location");
    }
}
function showPosition(position) {
	var lat =position.coords.latitude ;
	var lon =position.coords.longitude ;

	localStorage.setItem("lat", lat);
	localStorage.setItem("lon", lon);
	
	
		
	var geocoder;
geocoder = new google.maps.Geocoder();
var latlng = new google.maps.LatLng(lat, lon);
	geocoder.geocode(
    {'latLng': latlng}, 
    function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
                if (results[0]) {
                    var add= results[0].formatted_address ;
                    var  value=add.split(",");

                    count=value.length;
                    country=value[count-1];
                    state=value[count-2];
                    city=value[count-3];
					localStorage.setItem("city", city);
                 //   alert("you are here at " + city);
                }
                else  {
                    alert("address not found");
                }
        }
         else {
            alert("Geocoder failed due to: " + status);
        }
    }
);
	
	
}


var locations = [
    ["Zamboanga", "no", "Zamboanga", "", "6.916228, 122.069782", "http://maps.google.com/mapfiles/ms/icons/blue.png"],
    ["Metro Davao", "yes", "Metro Davao", "", "7.100497, 125.608841", "http://maps.google.com/mapfiles/ms/icons/green.png"],
    ["Valencia City", "no", "Valencia City", "", "7.865434, 125.169273", "http://maps.google.com/mapfiles/ms/icons/red.png"],
    ["Cagayan De Oro", "yes", "Cagayan De Oro", "", "8.456392, 124.627907", "http://maps.google.com/mapfiles/ms/icons/green.png"],
    ["Tacloban City", "yes", "Tacloban City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.374306,37.548933,0 -122.348557,37.538044,0 -122.359886,37.56363,0 -122.364006,37.582405,0 -122.33654,37.589207,0 -122.359543,37.59764,0 -122.372246,37.604712,0 -122.417564,37.594648,0 -122.374306,37.548933,0 </coordinates></LinearRing></outerBoundaryIs></Polygon>", "11.255724, 124.950940", "http://maps.google.com/mapfiles/ms/icons/blue.png"],
    ["Metro Cebu", "yes", "Metro Cebu", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.462883,37.628916,0 -122.445374,37.639247,0 -122.426147,37.648762,0 -122.405205,37.642238,0 -122.400055,37.628644,0 -122.392159,37.610696,0 -122.372246,37.604712,0 -122.417564,37.594648,0 -122.462196,37.628644,0  </coordinates></LinearRing></outerBoundaryIs></Polygon>", "10.308863, 123.915028", "http://maps.google.com/mapfiles/ms/icons/green.png"],
    ["Iloilo City", "yes", "Iloilo City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.43576,37.790795,0 -122.449493,37.801646,0 -122.425461,37.809784,0 -122.402115,37.811411,0 -122.390442,37.794593,0 -122.408295,37.79188,0 -122.434387,37.789167,0 </coordinates></LinearRing></outerBoundaryIs></Polygon>", "10.720089, 122.560381", "http://maps.google.com/mapfiles/ms/icons/green.png"],
    ["Puerto Princesa", "yes", "Puerto Princesa", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.463398,37.760266,0 -122.477349,37.774785,0 -122.427349,37.774785,0 -122.429237,37.763658,0 -122.46357,37.760808,0</coordinates></LinearRing></outerBoundaryIs></Polygon>", "9.9474401,118.5145237", "http://maps.google.com/mapfiles/ms/icons/green.png"],
    ["Legazpi City", "yes", "Legazpi City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.418766,37.747779,0 -122.425289,37.768951,0 -122.406063,37.769901,0 -122.406063,37.749679,0 -122.418251,37.747508,0 </coordinates></LinearRing></outerBoundaryIs></Polygon>", "13.1212078,123.6330866", "http://maps.google.com/mapfiles/ms/icons/green.png"],
    ["Lipa City", "yes", "Lipa City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.121277,37.386799,0 -122.108917,37.362244,0 -122.077675,37.3385,0 -122.064285,37.378615,0 -122.069778,37.3898,0 -122.076645,37.402619,0 -122.078705,37.411619,0 -122.113037,37.414618,0 -122.121277,37.386799,0  </coordinates></LinearRing></outerBoundaryIs></Polygon>", "13.944612,121.0981374", "http://maps.google.com/mapfiles/ms/icons/green.png"],
    ["Tagaytay City", "no", "Tagaytay City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.047119,37.33113,0 -122.065315,37.332495,0 -122.077675,37.3385,0 -122.064285,37.378615,0 -122.036819,37.385162,0 -122.006607,37.382162,0 -122.00386,37.342048,0 -122.047119,37.331403,0  </coordinates></LinearRing></outerBoundaryIs></Polygon>", "14.11722,120.8988919", "http://maps.google.com/mapfiles/ms/icons/blue.png"],
    ["Olongapo City", "no", "Olongapo City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-121.935196,37.345051,0 -121.931076,37.294267,0 -121.871338,37.293721,0 -121.806793,37.293174,0 -121.798553,37.361426,0 -121.879578,37.36088,0 -121.934509,37.345597,0 -121.935196,37.345051,0 </coordinates></LinearRing></outerBoundaryIs></Polygon>", "14.882156,120.2759178", "http://maps.google.com/mapfiles/ms/icons/blue.png"],
    ["Baguio City", "yes", "Baguio City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-121.935883,37.253287,0 -121.931076,37.294267,0 -121.871338,37.293721,0 -121.806793,37.293174,0 -121.790657,37.234702,0 -121.852455,37.223221,0 -121.935539,37.253014,0 </coordinates></LinearRing></outerBoundaryIs></Polygon>", "16.3995547,120.5537555", "http://maps.google.com/mapfiles/ms/icons/blue.png"],
    ["Laoag City", "yes", "Laoag City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-121.947556,37.435612,0 -121.934509,37.476493,0 -121.893311,37.469409,0 -121.852798,37.429615,0 -121.843872,37.400165,0 -121.887817,37.3898,0 -121.959915,37.420345,0 -121.959915,37.427979,0 -121.948929,37.435612,0 -121.947556,37.435612,0</coordinates></LinearRing></outerBoundaryIs></Polygon>", "18.1981728,120.5276349", "http://maps.google.com/mapfiles/ms/icons/blue.png"],
	["Tuguegarao City", "yes", "Tuguegarao City", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-121.947556,37.435612,0 -121.934509,37.476493,0 -121.893311,37.469409,0 -121.852798,37.429615,0 -121.843872,37.400165,0 -121.887817,37.3898,0 -121.959915,37.420345,0 -121.959915,37.427979,0 -121.948929,37.435612,0 -121.947556,37.435612,0</coordinates></LinearRing></outerBoundaryIs></Polygon>", "17.6022296,121.6894235", "http://maps.google.com/mapfiles/ms/icons/blue.png"],
    ["Metro Manila", "yes", "Metro Manila", "<Polygon><outerBoundaryIs><LinearRing><coordinates>-122.02343,37.52198,0 -122.023773,37.558731,0 -121.989784,37.573426,0 -121.959572,37.566351,0 -121.944466,37.544305,0 -121.967125,37.520891,0 -122.023087,37.522525,0</coordinates></LinearRing></outerBoundaryIs></Polygon>", "14.5655922,120.8845468", "http://maps.google.com/mapfiles/ms/icons/blue.png"]
];


var geocoder = null;
var map = null;
var customerMarker = null;
var markers = [];
var closest = [];
var newloc = null;
var arrCityName=[]; arrWindStr=[], arrWindDir=[];
var arrIcon1=[], arrMin1=[], arrMax1=[];
function initialize() {
var lats =localStorage.getItem("lat");;
var lons =localStorage.getItem("lon");;
    geocoder = new google.maps.Geocoder();
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 7,
        center: new google.maps.LatLng(lats, lons),
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    var infowindow = new google.maps.InfoWindow();
    var marker, i;
    var bounds = new google.maps.LatLngBounds();
    document.getElementById('info').innerHTML = "found " + locations.length + " locations<br>";
    for (i = 0; i < locations.length; i++) {
        var coordStr = locations[i][4];
        var coords = coordStr.split(",");
        var pt = new google.maps.LatLng(parseFloat(coords[0]), parseFloat(coords[1]));
		
        bounds.extend(pt);
        marker = new google.maps.Marker({
            position: pt,
            map: map,
            icon: locations[i][5],
            address: locations[i][2],
            title: locations[i][0],
            html: locations[i][0] + "<br>" + locations[i][2]
        });

        markers.push(marker);


        google.maps.event.addListener(marker, 'click', (function (marker, i) {
		  return function () {
                infowindow.setContent(marker.html);
                infowindow.open(map, marker);
            }
        })
		
        (marker, i));
    }
    map.fitBounds(bounds);	
}

function codeAddress() {

    //var address = localStorage.getItem("city");
  var address = "Ormoc";
    geocoder.geocode({
        'address': address
    }, function (results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
            map.setCenter(results[0].geometry.location);
            if (customerMarker) customerMarker.setMap(null);
            customerMarker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
            });
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            var numResults = parseInt(document.getElementById('numberResults').value);
            closest = findClosestN(results[0].geometry.location, numResults);
            for (var i = 0; i < closest.length; i++) {
                closest[i].setMap(map);
				newloc = closest[i].address;
				localStorage.setItem("newloc",newloc);
				alert(newloc);
				

            }
        } else {
            alert('Geocode was not successful for the following reason: ' + status);
        }
    });
	
	getData();
}

function findClosestN(pt, numberOfResults) {

    var closest = [];
    for (var i = 0; i < markers.length; i++) {
	

        markers[i].distance = google.maps.geometry.spherical.computeDistanceBetween(pt, markers[i].getPosition());

        markers[i].setMap(null);
        closest.push(markers[i]);
		
    }
    closest.sort(sortByDist);

 return closest.splice(0,numberOfResults);

	
}

function sortByDist(a, b) {
    return (a.distance - b.distance)
}

function getData(){
  $.ajax({
					type: "GET",
					url: "http://iligtas.ph/agaptest/outlook.php",
					async: false,
					success: function(myData){
					var newlocation = localStorage.getItem("newloc");
						   for(var i = 0; i < 16; i++){
						         arrCityName.push(myData.result.data[i].cityName);
								 if(newlocation == arrCityName[i]){
								      arrMin1.push(myData.result.data[i].day1.min);
										arrMax1.push(myData.result.data[i].day1.max);
									console.log("Min:"+myData.result.data[i].day1.min +"Max:"+myData.result.data[i].day1.max);
								 }
						 

						   }
					   
					}
					});
}
	

google.maps.event.addDomListener(window, 'load', initialize);
//]]> 

</script>

  
</head>

<body onLoad="codeAddress();">

<div style="display:none">
  <div id="map" style="height: 600px; width:800px;"></div>
<input id="numberResults" type="text" value="1" />
<input type="button" value="Search" onclick="codeAddress();"></input>
<div id="info"></div>
</div>
  
</body>

</html>

