$(document).ready(function(){function e(e){i=e.coords.latitude,g=e.coords.longitude,console.log("Current Location: "+i+","+g);var o={zoom:10,center:new google.maps.LatLng(i,g),mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};t=new google.maps.Map(document.getElementById("map-canvas"),o),google.maps.event.addListener(t,"idle",s),t.data.addListener("click",function(e){d.setContent("<img src="+e.feature.getProperty("icon")+"><br /><strong>"+e.feature.getProperty("city")+"</strong><br />"+e.feature.getProperty("temperature")+"&deg;C<br />"+e.feature.getProperty("weather")),d.setOptions({position:{lat:e.latLng.lat(),lng:e.latLng.lng()},pixelOffset:{width:0,height:-15}}),d.open(t)})}var t,o,n,a=!1,r="f409ef9bff7e0ac91c9f4074b3945a26",i=0,g=0;navigator.geolocation?navigator.geolocation.getCurrentPosition(e):console.log("error in getting location");var s=function(){for(;a===!0;)n.abort(),a=!1;p()},p=function(){var e=t.getBounds(),o=e.getNorthEast(),n=e.getSouthWest();c(o.lat(),o.lng(),n.lat(),n.lng())},c=function(e,o,i,g){a=!0;var s="http://api.openweathermap.org/data/2.5/box/city?bbox="+g+","+e+","+o+","+i+","+t.getZoom()+"&cluster=yes&format=json&APPID="+r;n=new XMLHttpRequest,n.onload=l,n.open("get",s,!0),n.send()},l=function(){console.log(this);var e=JSON.parse(this.responseText);if(e.list.length>0){f();for(var t=0;t<e.list.length;t++)o.features.push(u(e.list[t]));m(o)}},d=new google.maps.InfoWindow,u=function(e){var o={type:"Feature",properties:{city:e.name,weather:e.weather[0].main,temperature:e.main.temp,min:e.main.temp_min,max:e.main.temp_max,humidity:e.main.humidity,pressure:e.main.pressure,windSpeed:e.wind.speed,windDegrees:e.wind.deg,windGust:e.wind.gust,icon:"http://openweathermap.org/img/w/"+e.weather[0].icon+".png",coordinates:[e.coord.lon,e.coord.lat]},geometry:{type:"Point",coordinates:[e.coord.lon,e.coord.lat]}};return t.data.setStyle(function(e){return{icon:{url:e.getProperty("icon"),anchor:new google.maps.Point(25,25)}}}),o},m=function(e){t.data.addGeoJson(o),a=!1},f=function(){o={type:"FeatureCollection",features:[]},t.data.forEach(function(e){t.data.remove(e)})}});